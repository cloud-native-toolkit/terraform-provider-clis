name: Tag

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the main branch
on:
  push:
    branches: [ main ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  tag:
    runs-on: ubuntu-latest

    steps:
      # Drafts your next Release notes as Pull Requests are merged into "main"
      - name: Checkout
        uses: actions/checkout@v4

      # Create a draft release to generate a tag name
      - name: Draft release
        id: releaser
        uses: release-drafter/release-drafter@v6
        with:
          config-name: release-drafter.yaml
          publish: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # Delete the release because a new one will be created when tag is created
      - name: Delete release
        run: gh release delete ${{ steps.releaser.outputs.tag_name }}

      # Create a tag using the tag_name generated by Release Drafter
      - name: Create tag
        uses: mathieudutour/github-tag-action@v6.2
        with:
          custom_tag: ${{ steps.releaser.outputs.tag_name }}
          create_annotated_tag: true
          github_token: ${{ secrets.TOKEN }}
